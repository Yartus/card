# æˆå‘˜è¯†åˆ«ä¸å…³è”é€»è¾‘

## æ ¸å¿ƒé—®é¢˜

**ç®¡ç†å‘˜åœ¨åå°çœ‹åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•çŸ¥é“è¿™æ˜¯è°ï¼Ÿ**

---

## å½“å‰æ•°æ®æµ

### Step 1: å‘˜å·¥OAuthæˆæƒï¼ˆè‡ªåŠ¨è·å–ï¼‰

```
å‘˜å·¥åœ¨ä¼å¾®ä¸­æ‰“å¼€åº”ç”¨
  â†“
OAuthæˆæƒ
  â†“
åç«¯è·å–åˆ°ï¼š
  - open_userid: "womKtScgAAEkyZS7yXhQkhLqeCvf7ehQ" âœ…
  - avatar_url: "https://wework.qpic.cn/..." âœ…
  - name: "womKtScgAAEkyZS7yXhQkhLqeCvf7ehQ" âŒ (ä»æ˜¯åŠ å¯†ID)
  - mobile: null âŒ
  â†“
ä¿å­˜åˆ°æ•°æ®åº“ members è¡¨ï¼š
{
  id: 1,
  tenant_id: 3,
  open_userid: "womKtScgAAEkyZS7yXhQkhLqeCvf7ehQ",
  avatar_url: "https://wework.qpic.cn/...",
  name: null,  â† æš‚æ—¶ä¸ºç©º
  mobile: null,
  position: null
}
```

### Step 2: ç®¡ç†å‘˜æ‰“å¼€æˆå‘˜ç®¡ç†ç•Œé¢

**é—®é¢˜æ¥äº†ï¼šç®¡ç†å‘˜çœ‹åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿ**

```
å½“å‰ç•Œé¢æ˜¾ç¤ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤´åƒ   â”‚ å§“å                             â”‚ æ‰‹æœºå·   â”‚ æ“ä½œ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¼ï¸     â”‚ womKtScgAAEkyZS7yXhQkhLqeCvf7ehQâ”‚ -        â”‚ ç¼–è¾‘   â”‚
â”‚ ğŸ–¼ï¸     â”‚ womKtScgAAnk8xvR6WLRzU8Q7CZNlevQâ”‚ -        â”‚ ç¼–è¾‘   â”‚
â”‚ ğŸ–¼ï¸     â”‚ womKtScgAAUn6WKq_NHdfHkOABxsHw5Aâ”‚ -        â”‚ ç¼–è¾‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

âŒ **ç®¡ç†å‘˜å®Œå…¨ä¸çŸ¥é“è¿™äº›åŠ å¯†IDå¯¹åº”çš„æ˜¯è°ï¼**

---

## è§£å†³æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šåœ¨ç®¡ç†åå°ä¹Ÿç”¨ open-data ç»„ä»¶ â­â­â­â­â­

#### å®ç°æ–¹å¼

ç®¡ç†åå°ï¼ˆNuxtåº”ç”¨ï¼‰ä¹Ÿé›†æˆä¼å¾®JSSDKï¼Œä½¿ç”¨ `ww-open-data` ç»„ä»¶ï¼š

```vue
<!-- pages/wecom/workspace.vue -->
<template>
  <table class="members-table">
    <tr v-for="member in membersList" :key="member.id">
      <td>
        <img :src="member.avatar_url" />
      </td>
      
      <!-- âœ… ä½¿ç”¨ open-data ç»„ä»¶æ˜¾ç¤ºçœŸå®å§“å -->
      <td>
        <ww-open-data 
          v-if="member.open_userid"
          type="userName" 
          :openid="member.open_userid"
        ></ww-open-data>
        <span v-else class="muted">æœªæˆæƒ</span>
      </td>
      
      <td>
        <input v-if="editingId === member.id" v-model="editForm.mobile" />
        <span v-else>{{ member.mobile || '-' }}</span>
      </td>
      
      <td>
        <button @click="startEdit(member)">ç¼–è¾‘</button>
      </td>
    </tr>
  </table>
</template>

<script>
export default {
  mounted() {
    // åˆå§‹åŒ–ä¼å¾®JSSDK
    this.initWeworkSDK()
  },
  
  methods: {
    async initWeworkSDK() {
      // 1. åŠ è½½ä¼å¾®SDK
      await this.loadWeworkScript()
      
      // 2. è·å–ç­¾åï¼ˆä»åç«¯APIï¼‰
      const signature = await this.$axios.$get('/api/v1/wecom/jssdk/signature', {
        params: { url: window.location.href }
      })
      
      // 3. åˆå§‹åŒ– wx.agentConfig
      wx.agentConfig({
        corpid: signature.corpid,
        agentid: signature.agentid,
        timestamp: signature.timestamp,
        nonceStr: signature.nonceStr,
        signature: signature.signature,
        jsApiList: [],
        success: () => {
          console.log('âœ… ä¼å¾®SDKåˆå§‹åŒ–æˆåŠŸ')
          // 4. ç»‘å®šæ‰€æœ‰ open-data å…ƒç´ 
          this.$nextTick(() => {
            if (window.WWOpenData) {
              WWOpenData.bindAll(document.querySelectorAll('ww-open-data'))
            }
          })
        },
        fail: (err) => {
          console.error('âŒ ä¼å¾®SDKåˆå§‹åŒ–å¤±è´¥:', err)
        }
      })
    },
    
    startEdit(member) {
      this.editingId = member.id
      this.editForm = {
        id: member.id,
        mobile: member.mobile,
        position: member.position,
        // âš ï¸ æ³¨æ„ï¼šè¿™é‡Œä¸ç¼–è¾‘å§“åï¼Œå§“åç”± open-data æ˜¾ç¤º
      }
    },
    
    async saveEdit() {
      // ä¿å­˜æ—¶åªæ›´æ–° mobileã€position ç­‰å­—æ®µ
      await this.$axios.$put(`/api/v1/wecom/members/${this.editForm.id}`, {
        mobile: this.editForm.mobile,
        position: this.editForm.position
      })
    }
  }
}
</script>
```

#### ç®¡ç†å‘˜çœ‹åˆ°çš„æ•ˆæœ

```
å®é™…æ˜¾ç¤ºï¼ˆä¼å¾®è‡ªåŠ¨æ¸²æŸ“ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤´åƒ   â”‚ å§“å     â”‚ æ‰‹æœºå·      â”‚ æ“ä½œ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¼ï¸     â”‚ å¼ ä¸‰     â”‚ 13800138000 â”‚ ç¼–è¾‘   â”‚  â† ä¼å¾®æ¸²æŸ“çœŸå®å§“å
â”‚ ğŸ–¼ï¸     â”‚ æå››     â”‚ 13900139000 â”‚ ç¼–è¾‘   â”‚  â† ä¼å¾®æ¸²æŸ“çœŸå®å§“å
â”‚ ğŸ–¼ï¸     â”‚ ç‹äº”     â”‚ -           â”‚ ç¼–è¾‘   â”‚  â† ä¼å¾®æ¸²æŸ“çœŸå®å§“å
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¼–è¾‘æµç¨‹

```
1. ç®¡ç†å‘˜çœ‹åˆ°"å¼ ä¸‰"ï¼ˆopen-data æ˜¾ç¤ºï¼‰
   â†“
2. ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
   â†“
3. ç³»ç»Ÿè®°å½• member.id = 1ï¼ˆæ•°æ®åº“ä¸»é”®ï¼‰
   â†“
4. å¼¹å‡ºç¼–è¾‘æ¡†ï¼š
   - å§“åï¼šå¼ ä¸‰ï¼ˆåªè¯»ï¼Œopen-dataæ˜¾ç¤ºï¼‰
   - æ‰‹æœºå·ï¼š[å¯ç¼–è¾‘è¾“å…¥æ¡†]
   - èŒä½ï¼š[å¯ç¼–è¾‘è¾“å…¥æ¡†]
   â†“
5. ç®¡ç†å‘˜è¾“å…¥æ‰‹æœºå·ï¼š13800138000
   â†“
6. ä¿å­˜ï¼šPUT /api/v1/wecom/members/1
   {
     "mobile": "13800138000",
     "position": "äº§å“ç»ç†"
   }
   â†“
7. åç«¯æ ¹æ® member.id æ›´æ–°æ•°æ®åº“
```

#### åç«¯å¦‚ä½•è¯†åˆ«ï¼Ÿ

**å…³é”®ï¼šé€šè¿‡æ•°æ®åº“ä¸»é”® `id` è¯†åˆ«ï¼**

```python
# app/routes/wecom.py

@bp.route('/members/<int:member_id>', methods=['PUT'])
@jwt_required()
def update_member(member_id):
    """æ›´æ–°æˆå‘˜ä¿¡æ¯"""
    data = request.get_json()
    
    # âœ… é€šè¿‡ member_id (æ•°æ®åº“ä¸»é”®) æŸ¥æ‰¾æˆå‘˜
    member = Member.query.filter_by(
        id=member_id,
        tenant_id=current_user.tenant_id  # ç¡®ä¿ç§Ÿæˆ·éš”ç¦»
    ).first()
    
    if not member:
        return jsonify({'error': 'æˆå‘˜ä¸å­˜åœ¨'}), 404
    
    # âš ï¸ ä¸å…è®¸ä¿®æ”¹ open_useridï¼ˆä¼å¾®è¿”å›çš„å”¯ä¸€æ ‡è¯†ï¼‰
    # open_userid æ˜¯å…³è”ä¼å¾®ç”¨æˆ·çš„å”¯ä¸€å‡­è¯
    
    # âœ… åªæ›´æ–°ç®¡ç†å‘˜å¯ç¼–è¾‘çš„å­—æ®µ
    if 'mobile' in data:
        member.mobile = data['mobile']
    if 'position' in data:
        member.position = data['position']
    if 'custom_avatar_url' in data:
        member.custom_avatar_url = data['custom_avatar_url']
    if 'custom_push_photo_url' in data:
        member.custom_push_photo_url = data['custom_push_photo_url']
    
    db.session.commit()
    
    return jsonify({
        'success': True,
        'member': {
            'id': member.id,
            'open_userid': member.open_userid,  # è¿”å›ç»™å‰ç«¯ç”¨äº open-data
            'mobile': member.mobile,
            'position': member.position
        }
    })
```

---

### æ–¹æ¡ˆBï¼šè®©ç®¡ç†å‘˜æ‰‹åŠ¨è¾“å…¥"è¯†åˆ«åç§°" â­â­â­

#### å®ç°æ–¹å¼

å¢åŠ ä¸€ä¸ª `display_name` å­—æ®µï¼Œç®¡ç†å‘˜ç¬¬ä¸€æ¬¡éœ€è¦æ‰‹åŠ¨è¾“å…¥ï¼š

```
æ•°æ®åº“ï¼š
{
  id: 1,
  open_userid: "womKtScgAAEkyZS7yXhQkhLqeCvf7ehQ",
  display_name: null,  â† æ–°å¢å­—æ®µï¼Œç®¡ç†å‘˜æ‰‹åŠ¨è¾“å…¥
  mobile: null
}
```

#### é¦–æ¬¡è®¾ç½®æµç¨‹

```
1. å‘˜å·¥OAuthæˆæƒåï¼Œç®¡ç†å‘˜çœ‹åˆ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤´åƒ   â”‚ è¯†åˆ«åç§°             â”‚ æ‰‹æœºå·   â”‚ æ“ä½œ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¼ï¸     â”‚ [è¯·è®¾ç½®è¯†åˆ«åç§°]     â”‚ -        â”‚ è®¾ç½®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. ç®¡ç†å‘˜ç‚¹å‡»"è®¾ç½®"ï¼Œè¾“å…¥ï¼š
   - è¯†åˆ«åç§°ï¼šå¼ ä¸‰
   - æ‰‹æœºå·ï¼š13800138000
   
3. ä¿å­˜åï¼Œæ•°æ®åº“ï¼š
{
  id: 1,
  open_userid: "womKtScgAAEkyZS7yXhQkhLqeCvf7ehQ",
  display_name: "å¼ ä¸‰",  â† ç®¡ç†å‘˜è¾“å…¥
  mobile: "13800138000"
}

4. ä¹‹åç®¡ç†å‘˜çœ‹åˆ°çš„åˆ—è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤´åƒ   â”‚ è¯†åˆ«åç§° â”‚ æ‰‹æœºå·      â”‚ æ“ä½œ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¼ï¸     â”‚ å¼ ä¸‰     â”‚ 13800138000 â”‚ ç¼–è¾‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

âŒ **é—®é¢˜**ï¼š
- ç®¡ç†å‘˜ä¸çŸ¥é“è¯¥ç»™è¿™ä¸ªåŠ å¯†IDè®¾ç½®ä»€ä¹ˆåå­—
- éœ€è¦é¢å¤–æ²Ÿé€šï¼š"womKtScg... è¿™ä¸ªIDæ˜¯è°ï¼Ÿ"

---

### æ–¹æ¡ˆCï¼šæ··åˆæ–¹æ¡ˆï¼ˆç»“åˆ A + Bï¼‰ â­â­â­â­

#### å®ç°æ–¹å¼

```vue
<td>
  <!-- ä¼˜å…ˆæ˜¾ç¤º open-dataï¼ˆå¦‚æœSDKå·²åŠ è½½ï¼‰ -->
  <ww-open-data 
    v-if="wwOpenDataReady && member.open_userid"
    type="userName" 
    :openid="member.open_userid"
  ></ww-open-data>
  
  <!-- é™çº§æ˜¾ç¤º display_name -->
  <span v-else-if="member.display_name">
    {{ member.display_name }}
  </span>
  
  <!-- æœ€åæ˜¾ç¤ºåŠ å¯†ID -->
  <code v-else class="userid-code">
    {{ member.open_userid ? member.open_userid.slice(0, 12) + '...' : '-' }}
  </code>
</td>
```

---

## æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆAï¼ˆç®¡ç†åå°é›†æˆ open-dataï¼‰

### ä¼˜åŠ¿

1. âœ… **ç®¡ç†å‘˜çœ‹åˆ°çœŸå®å§“å**ï¼šä¼å¾®è‡ªåŠ¨æ¸²æŸ“ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥
2. âœ… **åç«¯é€šè¿‡ `id` è¯†åˆ«**ï¼šä¸ä¾èµ–å§“åï¼Œæ›´å¯é 
3. âœ… **è‡ªåŠ¨æ›´æ–°**ï¼šå¦‚æœå‘˜å·¥åœ¨ä¼å¾®ä¸­æ”¹åï¼Œè‡ªåŠ¨åŒæ­¥æ˜¾ç¤º
4. âœ… **éšç§ä¿æŠ¤**ï¼šå§“åä¸å­˜å‚¨åœ¨æ‚¨çš„æ•°æ®åº“ï¼Œç¬¦åˆä¼å¾®è§„èŒƒ

### å…³é”®å®ç°ç‚¹

#### 1. åç«¯æä¾› JSSDK ç­¾åæ¥å£

```python
# app/routes/wecom.py

@bp.route('/jssdk/signature', methods=['GET'])
@jwt_required()
def get_jssdk_signature():
    """è·å–ä¼å¾®JSSDKç­¾åï¼ˆç”¨äºç®¡ç†åå°ï¼‰"""
    url = request.args.get('url')
    if not url:
        return jsonify({'error': 'ç¼ºå°‘urlå‚æ•°'}), 400
    
    tenant = current_user.tenant
    
    # è·å– corp_access_token
    corp_token = get_corp_access_token(tenant.corp_id, tenant.permanent_code)
    if not corp_token:
        return jsonify({'error': 'è·å–ä¼ä¸šå‡­è¯å¤±è´¥'}), 500
    
    # è·å– jsapi_ticket
    resp = requests.get(
        'https://qyapi.weixin.qq.com/cgi-bin/get_jsapi_ticket',
        params={'access_token': corp_token},
        timeout=5
    )
    ticket_data = resp.json()
    
    if ticket_data.get('errcode') != 0:
        return jsonify({'error': 'jsapi_ticketè·å–å¤±è´¥'}), 500
    
    ticket = ticket_data['ticket']
    
    # ç”Ÿæˆç­¾å
    timestamp = str(int(time.time()))
    nonce_str = ''.join(random.choices(string.ascii_letters + string.digits, k=16))
    
    sign_str = f"jsapi_ticket={ticket}&noncestr={nonce_str}&timestamp={timestamp}&url={url}"
    signature = hashlib.sha1(sign_str.encode()).hexdigest()
    
    return jsonify({
        'corpid': tenant.corp_id,
        'agentid': current_app.config.get('WECOM_AGENT_ID'),
        'timestamp': timestamp,
        'nonceStr': nonce_str,
        'signature': signature
    })
```

#### 2. å‰ç«¯åˆå§‹åŒ– open-data

```vue
<!-- pages/wecom/workspace.vue -->
<script>
export default {
  data() {
    return {
      wwOpenDataReady: false
    }
  },
  
  async mounted() {
    // åŠ è½½ä¼å¾®SDK
    await this.loadScripts([
      'https://res.wx.qq.com/open/js/jweixin-1.2.0.js',
      'https://open.work.weixin.qq.com/wwopen/js/jwxwork-1.0.0.js'
    ])
    
    // åˆå§‹åŒ–
    await this.initWeworkSDK()
  },
  
  methods: {
    async initWeworkSDK() {
      try {
        // è·å–ç­¾å
        const signature = await this.$axios.$get('/api/v1/wecom/jssdk/signature', {
          params: { url: window.location.href.split('#')[0] }
        })
        
        // agentConfig
        await new Promise((resolve, reject) => {
          wx.agentConfig({
            corpid: signature.corpid,
            agentid: signature.agentid,
            timestamp: signature.timestamp,
            nonceStr: signature.nonceStr,
            signature: signature.signature,
            jsApiList: [],
            success: resolve,
            fail: reject
          })
        })
        
        // æ ‡è®°å°±ç»ª
        this.wwOpenDataReady = true
        
        // ç»‘å®šæ‰€æœ‰ open-data å…ƒç´ 
        this.$nextTick(() => {
          if (window.WWOpenData) {
            WWOpenData.bindAll(document.querySelectorAll('ww-open-data'))
          }
        })
        
        console.log('âœ… ä¼å¾® open-data åˆå§‹åŒ–æˆåŠŸ')
      } catch (err) {
        console.error('âŒ ä¼å¾® open-data åˆå§‹åŒ–å¤±è´¥:', err)
        // é™çº§ï¼šä½¿ç”¨ display_name æˆ–åŠ å¯†ID
      }
    }
  }
}
</script>
```

#### 3. ç¼–è¾‘æ—¶é€šè¿‡ `id` å…³è”

```vue
<script>
export default {
  methods: {
    startEdit(member) {
      // âœ… å…³é”®ï¼šä¿å­˜ member.idï¼ˆæ•°æ®åº“ä¸»é”®ï¼‰
      this.editingMemberId = member.id
      
      // å¡«å……ç¼–è¾‘è¡¨å•
      this.editForm = {
        id: member.id,           // â† åç«¯é€šè¿‡è¿™ä¸ªè¯†åˆ«
        mobile: member.mobile,
        position: member.position,
        customAvatarUrl: member.custom_avatar_url,
        customPushPhotoUrl: member.custom_push_photo_url
      }
    },
    
    async saveEdit() {
      try {
        // PUT /api/v1/wecom/members/{id}
        await this.$axios.$put(
          `/api/v1/wecom/members/${this.editForm.id}`,  // â† é€šè¿‡IDè¯†åˆ«
          {
            mobile: this.editForm.mobile,
            position: this.editForm.position,
            custom_avatar_url: this.editForm.customAvatarUrl,
            custom_push_photo_url: this.editForm.customPushPhotoUrl
          }
        )
        
        // åˆ·æ–°åˆ—è¡¨
        await this.loadMembers()
        this.editingMemberId = null
      } catch (err) {
        alert('ä¿å­˜å¤±è´¥ï¼š' + err.message)
      }
    }
  }
}
</script>
```

---

## æ€»ç»“

### åç«¯å¦‚ä½•è¯†åˆ«æˆå‘˜ï¼Ÿ

**ç­”æ¡ˆï¼šé€šè¿‡æ•°æ®åº“ä¸»é”® `members.id`ï¼**

```
å…³è”å…³ç³»ï¼š
members.id (ä¸»é”®) â†’ å”¯ä¸€æ ‡è¯†æ•°æ®åº“ä¸­çš„ä¸€æ¡æˆå‘˜è®°å½•
  â†“ å…³è”
members.open_userid â†’ å”¯ä¸€æ ‡è¯†ä¼å¾®ä¸­çš„ç”¨æˆ·
  â†“ open-data ç»„ä»¶
ä¼å¾®å®¢æˆ·ç«¯ â†’ æ¸²æŸ“çœŸå®å§“åï¼ˆä¸å­˜å‚¨åœ¨æ‚¨çš„æ•°æ®åº“ï¼‰
```

### æ•°æ®æµ

```
1. OAuthæˆæƒï¼š
   å‘˜å·¥ â†’ open_userid â†’ ä¿å­˜åˆ° members è¡¨ â†’ ç”Ÿæˆ id (ä¸»é”®)

2. ç®¡ç†å‘˜æŸ¥çœ‹ï¼š
   GET /api/v1/wecom/members
   â†’ è¿”å› [{id: 1, open_userid: "wom...", mobile: "138..."}]
   â†’ å‰ç«¯ç”¨ open-data æ˜¾ç¤ºå§“å

3. ç®¡ç†å‘˜ç¼–è¾‘ï¼š
   ç‚¹å‡»"ç¼–è¾‘" â†’ è®°å½• member.id = 1
   â†’ è¾“å…¥æ‰‹æœºå·
   â†’ PUT /api/v1/wecom/members/1 {mobile: "138..."}
   â†’ åç«¯æ ¹æ® id=1 æ›´æ–°æ•°æ®åº“
```

### ä¸ºä»€ä¹ˆä¸ç”¨ open_userid ä½œä¸ºè¯†åˆ«ä¾æ®ï¼Ÿ

- âœ… å¯ä»¥ç”¨ï¼Œä½† `id` æ›´ç®€æ´
- âœ… `id` æ˜¯æ•°æ®åº“ä¸»é”®ï¼ŒæŸ¥è¯¢æ•ˆç‡æ›´é«˜
- âœ… `open_userid` å¤ªé•¿ï¼ŒURLä¸ç¾è§‚

---

**è¿™ä¸ªæ–¹æ¡ˆæ¸…æ¥šäº†å—ï¼Ÿæˆ‘å¯ä»¥ç«‹å³å¼€å§‹å®æ–½ã€‚**

