# 开发任务清单

## 当前冲刺（两周）- 名片功能细化（2025-09-22 起）
本段为精简执行清单；历史与长期事项保留在文末“Backlog（历史保留）”，不纳入当前执行范围。

### P0（必须，本周完成）
- 完成 `components/WecardOptimized.vue` 基础渲染：`CardHeader`、`QuickActions`、`ContactInfo`、`BusinessShowcase`
- 建立 WeCom ID↔内部ID 映射并落库，避免硬编码；实现 `CardProfile` 字段映射
- 快速操作按钮打通：拨打电话、复制微信、保存联系人、分享名片
- 环境适配：微信内 H5 与小程序差异分支（最小可用）
- API 可用：`/api/card/profile` GET/PUT、`/api/card/preview/thumbnail` POST、`/api/card/settings/contact-visibility` PUT
- 预览页联通：`/card-preview` 可加载新组件并通过 3 套演示数据渲染

### P1（第二周优先）
- 时间线与客户 Logo：`/api/card/timeline/:member_id`、`/api/card/clients/:tenant_id` 基础版
- 素材库（基础版）：`/api/assets/:tenant_id` GET/POST；免费3张/付费10张校验
- 统计埋点：`AnalyticsTracker` + `/api/card/analytics` POST（page_view/quick_action 等）
- 视觉规范：落实“白底轻科幻规范”核心要点（Header 微光、细描边、动画密度开关）

### P2（可选）
- 分享缩略图缓存与回退策略完善
- 行业模板 2 套示例与主题切换

### 验收标准（本冲刺）
- `WecardOptimized.vue` 正常渲染，移动端表现良好
- 快速操作按钮功能可用，埋点上报成功
- WeCom 字段映射生效，内部 ID 映射正确
- 时间线/客户 Logo/素材库基础能力可用（P1 完成时）

---

## Backlog（历史保留）
以下为历史清单与长期规划，保持原样；当前以“当前冲刺”清单为准。

## 阶段 T - 测试阶段重点（P0-P2）
- [ ] P0：端到端授权与回调联测（最高优先级）
  - [ ] 扫码安装标准应用，收到 create_auth，获取 permanent_code 并落库租户
  - [ ] 验证 suite_ticket/change_auth/cancel_auth/command 事件，确保均 200 且日志正确
  - [ ] 引入 Redis 缓存 suite_ticket（含过期与刷新），避免重启后丢失导致链路中断
  - [ ] 观测回调 2xx 比率、鉴签失败率，确保 Nginx→gunicorn 链路稳定
- [ ] P1：小程序端可用性
  - [ ] 配置小程序 request/uploadFile/downloadFile/websocket 合法域名（含对象存储/静态域名）
  - [ ] 实现 wx.login→code2session 并存储 session_key；确定成员/外部联系人绑定策略
  - [ ] 小程序内提供安装/管理入口，打通到安装二维码/授权状态页
- [ ] P1：企业微信数据与权限
  - [ ] permanent_code→tenant 落库、套餐占位与激活态切换
  - [ ] 同步部门与成员，落库 WeCom ID↔内部ID 映射，避免硬编码
  - [ ] 处理 change_contact 增删改事件并回 200
- [ ] P2（可选）：支付接入
  - [ ] 微信支付 v3：证书/序列号、下单与支付回调、退款回调链路
- [ ] P2：监控与风控
  - [ ] Nginx/gunicorn 日志与 logrotate；关键指标与告警（回调 5xx、鉴签失败突增、suite_ticket 超时）

## 运维与部署（生产）
- [ ] 使用 gunicorn + systemd 托管 API（127.0.0.1:5001）
- [ ] Nginx `/api/` 反向代理到 127.0.0.1:5001（保留必要头与超时设置）
- [ ] 配置 `.env` 环境变量并迁移敏感信息；仓库包含 `.env.example`；`.env` 权限 600
- [ ] 健康检查 `/healthz` 可用；预留 `/api` 健康探活（可选）
- [ ] systemd 支持平滑重载与优雅退出（ExecReload/HUP、SIGTERM）；根据并发调优 workers/threads
- [ ] 建立基础监控面板：回调量、2xx 比率、鉴签失败率、suite_ticket 更新时间

## 自动化测试与自测
- [ ] 增加 pytest smoke：授权与回调链路、变更事件、指令回调
- [ ] 保留 `test_callback.py` 作为端到端自测脚本（含 GET/POST/COMMAND 四项）
- [ ]（可选）CI 集成基础用例，提交即跑 smoke

## 阶段 M0.5 - 前期准备工作（新增）
### 法务和合规
- [ ] 申请企业微信服务商资质认证（🔴 高优先级）
- [ ] 制定用户隐私协议和服务条款
- [ ] 进行数据安全和合规性审查
- [ ] 申请商标和著作权保护

### 基础设施和域名
- [ ] 购买主域名（如 wecard.com）（🔴 高优先级）
- [ ] 申请和配置SSL证书
- [ ] 配置CDN加速服务
- [ ] 完成网站备案和ICP许可证申请

### 微信生态准备
- [ ] 注册和认证微信小程序（🔴 高优先级）
- [ ] 申请微信支付商户号
- [ ] 注册企业微信服务商账号
- [ ] 创建企业微信第三方应用

### 安全和运维
- [ ] 制定API安全防护策略
- [ ] 设计数据加密和脱敏方案
- [ ] 选型监控和日志系统
- [ ] 制定备份和灾备方案

## 阶段 M0.8 - 名片内容优化（并行进行）
### 第一阶段：基础重构（本周完成）
- [ ] 分析现有Vcard.vue组件结构和字段
- [ ] 设计企业微信适配的新字段结构
- [ ] 创建WecardOptimized.vue优化版本组件
- [ ] 实现中国商务习惯的字段映射

### 第二阶段：视觉和交互优化（1-2周）
- [ ] 设计移动端优先的响应式布局
- [ ] 实现企业级配色方案和视觉规范
- [ ] 添加快速操作按钮（拨打、微信、保存、分享）
- [ ] 优化微信浏览器和小程序环境适配

### 白底轻科幻规范（实现清单）
- [ ] Header：浅网格+微光晕+细扫线（滚出视口暂停，移动端保留）
- [ ] 分隔线/卡片：1px 细描边+微阴影，hover 200ms 提升
- [ ] 粒子光点：Header 角落 3-5 个慢速位移（移动端保留、稀疏）
- [ ] 时间线：弱“流光”效果（10s 一次、2s 停驻），移动端保留但减弱
- [ ] Logo 轮播：30s 无缝滚动、hover 暂停、统一尺寸留白
- [ ] 动画密度档位与开关：reduced/default/rich；headerGlow/scanLine/lineShimmer/logoMarquee

### 新增模块开发（并行）
- [ ] Header 模块与 Slogan 置顶（纯色/半透明背景、联系方式显示开关）
- [ ] 分享预览图：默认模板生成 + 自定义上传覆盖
- [ ] 企业时间线：左右交错布局，中线/虚线；套餐上限校验
- [ ] 合作客户 Logo 列表：统一尺寸/形状，平滑轮播
- [ ] 图文与媒体混排：懒加载；视频仅付费（≤20MB、≤240px高）
- [ ] 素材库模块：独立链接+名片入口；免费3张/付费10张

### 第三阶段：功能增强（2-3周）
- [ ] 实现企业微信数据自动同步逻辑
- [ ] 添加智能数据补全和缺失提示
- [ ] 实现访问统计和用户行为追踪
- [ ] 开发个性化推荐系统基础版

### 第四阶段：体验优化（1周）
- [ ] 性能优化和加载速度提升
- [ ] 用户体验测试和问题修复
- [ ] 数据分析面板基础版开发
- [ ] 多行业模板支持（金融、医疗、制造等）

### 名片优化技术实现细节
#### 数据模型设计
- [ ] 设计CardProfile数据模型（基础信息、联系方式、业务展示、互动功能）
- [ ] 创建CardTemplate模板系统（行业模板、色彩主题、布局方案）
- [ ] 实现CardAnalytics统计模型（访问记录、用户行为、转化数据）
- [ ] 建立WeCom数据同步映射关系

#### 前端组件开发
- [ ] 重构components/WecardOptimized.vue主组件
- [ ] 创建CardHeader.vue（头像、姓名、职位、公司）
- [ ] 开发QuickActions.vue（快速操作按钮组）
- [ ] 实现ContactInfo.vue（联系方式展示）
- [ ] 构建BusinessShowcase.vue（业务展示区）
- [ ] 开发InteractiveFeatures.vue（二维码、分享等）

#### 后端API接口
- [ ] /api/card/profile GET/PUT（获取/更新名片信息）
- [ ] /api/card/template GET（获取可用模板列表）
- [ ] /api/card/analytics POST（记录访问统计）
- [ ] /api/wecom/sync POST（同步企业微信数据）
- [ ] /api/card/share POST（生成分享链接）
 - [ ] /api/card/preview/thumbnail POST（生成或刷新分享缩略图）
 - [ ] /api/card/settings/contact-visibility PUT（联系方式显示开关）
 - [ ] /api/card/timeline/:member_id GET/PUT（企业时间线）
 - [ ] /api/card/clients/:tenant_id GET/PUT（合作客户Logo）
 - [ ] /api/assets/:tenant_id GET/POST/DELETE（素材库）

#### 小程序适配
- [ ] 创建miniprogram/components/WeCard.wxml
- [ ] 实现小程序专用交互逻辑（拨打电话、复制微信、保存联系人）
- [ ] 适配小程序分享功能
- [ ] 优化小程序加载性能
 - [ ] 小程序分享缩略图生成与缓存
 - [ ] 小程序素材库独立页面与入口

### 立即行动计划（今日-本周）
#### 今日任务（2-3小时）
- [ ] 🔴 分析现有/opt/qwcard/components/Vcard.vue结构
- [ ] 🔴 设计新的字段映射方案（参考docs/3.名片内容优化方案.md）
- [ ] 🔴 创建WecardOptimized.vue基础版本
- [ ] 🟡 设计企业微信字段同步逻辑

#### 明日任务（4-6小时）
- [ ] 🔴 实现基础的快速操作按钮
- [ ] 🔴 优化移动端响应式布局
- [ ] 🟡 添加企业级配色方案
- [ ] 🟡 实现基础的数据统计埋点

#### 本周任务（每日2-4小时）
- [ ] 🔴 完成WecardOptimized.vue核心功能
- [ ] 🔴 实现企业微信数据映射
- [ ] 🟡 添加访问统计功能
- [ ] 🟢 设计多套行业模板

### 验收标准
#### 第一阶段完成标准
- [ ] WecardOptimized.vue可正常渲染
- [ ] 支持企业微信基础字段同步
- [ ] 快速操作按钮功能正常
- [ ] 移动端适配良好
 - [ ] Header/预览图/时间线/客户Logo/媒体混排/素材库基础版本可用

#### 最终验收标准
- [ ] 名片加载速度<2秒
- [ ] 移动端体验评分>90分
- [ ] 支持5+行业模板
- [ ] 数据统计功能完整
- [ ] 企业微信集成度>80%
 - [ ] 分享缩略图生成成功率>99%，轮播与时间线动画无明显卡顿

## 阶段 M0 - 项目初始化
- [ ] 创建项目骨架，requirements.txt，docker-compose.yml
- [ ] 验证 docker-compose 可启动 mysql/redis/minio，Flask 本地可运行 /healthz

## 阶段 M1 - 数据模型与路由
- [ ] 定义 SQLAlchemy 模型：Tenant、Member、CardTemplate、FileAsset、CardLog、Plan
- [ ] 编写基础路由 stub：/install、/auth/callback、/wecom/callback、/card/<tenant>/<member>、/files/upload、/admin/tenant/<id>/stats

## 阶段 M2 - SaaS平台管理后台
- [ ] 开发微信小程序平台管理端
- [ ] 实现租户管理界面（查看、编辑、删除）
- [ ] 套餐管理功能（免费/付费/高级版）
- [ ] 权限分配系统（功能开关、API配额）
- [ ] 平台数据统计面板

## 阶段 M3 - 企业微信二维码安装模式
- [ ] 注册企业微信服务商，获取SuiteID和SuiteSecret
- [ ] 创建第三方应用（选择非商城上线模式）
- [ ] 配置应用回调URL和权限范围
- [ ] /install 生成企微安装二维码（包含预授权码）
- [ ] /auth/callback 处理企业扫码授权回调
- [ ] 创建租户记录并分配默认免费套餐
- [ ] 实现租户权限验证中间件
- [ ] 租户API调用配额管理

## 阶段 M4 - 租户权限系统
- [ ] 实现 TenantPermission 数据模型
- [ ] 开发权限验证装饰器 @check_tenant_permission
- [ ] API调用统计和配额限制
- [ ] 套餐功能限制检查

## 阶段 M5 - 名片展示端开发
- [ ] 开发微信小程序名片展示界面
- [ ] H5页面微信环境适配
- [ ] 支持名片模板变量替换
- [ ] 企业品牌定制功能

## 阶段 M6 - 成员同步与模板系统
- [ ] 调用企业微信 SDK 获取成员信息
- [ ] 支持名片模板 CRUD（租户级别）
- [ ] 渲染接口返回个人名片数据

## 阶段 M7 - 文件上传与存储管理
- [ ] 接入 MinIO / S3 客户端
- [ ] 租户存储配额管理
- [ ] 检查套餐限制（logo、视频、文件大小/数量）
- [ ] 返回文件元信息和CDN链接

## 阶段 M8 - 跨平台推送功能
- [ ] /wecom/callback 验证签名，写日志
- [ ] 实现推送到企业自己的小程序
- [ ] 推送数据统计和追踪
- [ ] 消息队列处理推送任务

## 阶段 M9 - 平台数据统计与收费管理
- [ ] 平台级数据统计（所有租户）
- [ ] 租户级数据统计（名片访问、推送次数）
- [ ] 实时数据面板
- [ ] 自主收费系统（避免官方付款机制）
- [ ] 套餐升级和续费管理
- [ ] 数据导出功能

## 阶段 M10 - 质量保证与上线准备
- [ ] 配置 pytest 测试（包含多租户测试）
- [ ] 添加 GitHub Actions CI
- [ ] 性能测试和负载测试
- [ ] 安全渗透测试
- [ ] 数据备份和恢复测试
- [ ] 监控和告警系统配置
- [ ] 生产环境部署和验证

## 阶段 M11 - 运营和维护（持续）
- [ ] 用户反馈收集和处理机制
- [ ] 系统性能监控和优化
- [ ] 企业微信API变更适配
- [ ] 功能迭代和版本管理
- [ ] 客户支持和技术文档维护

## 阶段 M12 - 应用商城上架准备（阶段二）
### 应用完善和优化
- [ ] 核心功能稳定性验证
- [ ] 性能优化（API响应<100ms，并发>5万）
- [ ] 系统可用性提升至99.9%
- [ ] 全面的错误处理和用户体验优化

### 官方付费机制对接
- [ ] 研究企业微信官方付费API
- [ ] 设计官方收费模式集成方案
- [ ] 开发订单管理和支付状态同步
- [ ] 实现套餐变更和退款处理

### 商城审核材料准备
- [ ] 编写详细的应用说明文档
- [ ] 制作功能演示视频
- [ ] 完善用户使用手册
- [ ] 更新隐私政策和服务条款
- [ ] 进行安全和性能测试，生成报告
- [ ] 收集客户案例和推荐信

### 品牌和营销准备
- [ ] 设计高清应用图标和截图
- [ ] 制作产品宣传视频
- [ ] 编写产品白皮书和技术架构说明
- [ ] 申请相关安全合规证书
- [ ] 制定商城上架营销策略

### 运营支持体系建设
- [ ] 建立7x24小时客户支持体系
- [ ] 完善在线帮助文档和FAQ
- [ ] 制作视频教程库
- [ ] 搭建工单系统
- [ ] 团队企业微信官方认证培训

## 阶段 M13 - 商城审核和上架
- [ ] 提交商城上架申请
- [ ] 配合官方审核流程
- [ ] 根据审核反馈进行调整
- [ ] 正式上架后的运营推广