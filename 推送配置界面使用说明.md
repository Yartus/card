# 推送配置界面使用说明

## ✅ 集成完成

已成功将推送配置界面集成到工作台页面！

---

## 📍 访问路径

1. 从企业微信打开应用
2. 自动跳转到 `/wecom/workspace` 工作台
3. 点击顶部的**"📨 推送消息配置"**标签页

---

## 🎨 界面功能

### 标签页切换

工作台现在有两个标签页：

```
┌─────────────────────────────────────┐
│  🎨 名片模块配置  │  📨 推送消息配置  │ ← 标签页
├─────────────────────────────────────┤
│                                     │
│  [配置内容区域]                      │
│                                     │
└─────────────────────────────────────┘
```

### 推送消息配置（新功能）

**功能列表**：

1. **消息标题** 📌
   - 文本输入框
   - 字符计数（最多30字）
   - 实时验证

2. **消息描述** 📝
   - 多行文本框
   - 字符计数（最多100字）
   - 实时验证

3. **封面图片** 🖼️（可选）
   - URL输入框
   - 实时图片预览
   - 支持HTTPS链接

4. **消息预览** 👀
   - 实时预览效果
   - 模拟客户看到的样式
   - 动态更新

5. **快速模板** 🚀
   - 专业型模板
   - 亲和型模板
   - 简洁型模板
   - 一键应用

6. **优化建议** 💡
   - 内置最佳实践提示
   - 帮助提高转化率

---

## 🔧 使用流程

### 步骤1：切换到推送配置

点击顶部的 **"📨 推送消息配置"** 标签

### 步骤2：填写配置信息

```
消息标题：这是我的数字名片 👋
消息描述：📱 点击查看我的联系方式和服务介绍，期待与您交流
封面图片：https://your-domain.com/logo.jpg （可选）
```

### 步骤3：实时预览

右侧会实时显示消息卡片预览效果，确认样式符合预期

### 步骤4：保存配置

点击右上角的 **"💾 保存配置"** 按钮

### 步骤5：测试推送

使用全新的外部联系人测试添加好友功能

---

## 📊 技术实现

### 前端组件

- **主页面**：`/opt/qwcard/pages/wecom/workspace.vue`
- **配置组件**：`/opt/qwcard/components/workspace/config/PushConfigSection.vue`

### 数据流

```
用户输入
  ↓
组件状态更新（v-model）
  ↓
pushConfigDirty = true
  ↓
点击保存按钮
  ↓
PUT /api/v1/wecom/tenant/workspace
  ↓
数据库 tenants.config.push_config
  ↓
重启API服务（自动生效）
  ↓
添加好友时使用新配置
```

### API接口

**保存推送配置**：
```
PUT /api/v1/wecom/tenant/workspace
Authorization: Bearer {JWT_TOKEN}

Body:
{
  "push_config": {
    "cardTitle": "标题",
    "cardDesc": "描述",
    "cardImage": "图片URL"
  }
}
```

**响应**：
```json
{
  "success": true,
  "message": "配置已保存"
}
```

---

## 🎯 配置示例

### 示例1：专业服务型

```
标题：专属数字名片 - 专业服务
描述：💼 点击了解我的服务和联系方式，期待为您服务
图片：https://example.com/professional.jpg
```

### 示例2：亲和力型

```
标题：这是我的电子名片 👋
描述：很高兴认识您！点击查看更多关于我的信息
图片：https://example.com/friendly.jpg
```

### 示例3：简洁型

```
标题：我的联系方式
描述：点击查看电话、微信、邮箱等联系信息
图片：（留空）
```

---

## ⚙️ 高级功能

### 字符计数

自动统计输入字符数，防止超出限制：
- 标题：最多30字
- 描述：最多100字

### 图片预览

输入图片URL后自动显示预览：
- 支持HTTPS链接
- 自动错误处理
- 加载失败提示

### 实时预览

配置更改后立即在预览区域显示效果

### 未保存提示

有未保存的更改时：
- 保存按钮高亮
- 离开页面时提示确认

---

## 🐛 故障排查

### 问题1：保存按钮不可用

**原因**：没有修改任何内容  
**解决**：修改任意配置项后保存按钮会激活

### 问题2：图片不显示

**原因**：
- URL不是HTTPS
- 图片不存在
- 跨域限制

**解决**：
- 使用HTTPS链接
- 检查图片是否可访问
- 使用自己域名的图片

### 问题3：配置未生效

**原因**：API服务未重启  
**解决**：
```bash
systemctl restart wecard-api.service
```

### 问题4：界面加载失败

**原因**：前端服务未启动  
**解决**：
```bash
systemctl restart wecard-nuxt.service
```

---

## 📱 客户端效果

配置保存后，客户收到的消息格式：

```
┌───────────────────────────────┐
│ [封面图片]                     │
│                               │
│ 这是我的数字名片 👋            │
│                               │
│ 📱 点击查看我的联系方式和      │
│ 服务介绍，期待与您交流         │
│                               │
│ [查看详情 →]                  │
└───────────────────────────────┘
```

---

## 🚀 下一步

1. ✅ 前端界面已集成完成
2. ✅ 数据保存功能已实现
3. ✅ 实时预览功能已完成
4. ⏳ 等待用户测试反馈
5. ⏳ 根据反馈优化界面

---

## 📞 技术支持

如遇问题，请提供：
1. 操作步骤截图
2. 浏览器控制台日志
3. 服务器日志：
   ```bash
   journalctl -u wecard-nuxt.service -f
   journalctl -u wecard-api.service -f
   ```

---

**现在可以登录企业微信，进入应用工作台测试新功能了！** 🎉
